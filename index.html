<!doctype html>
<html lang="en">
<head>
  <link href="css/button.css" rel="stylesheet">
  <link href="css/main.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
  <link rel="stylesheet" href="css/leaflet.css" />
  <link href="css/c3.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />
  <link href="https://fonts.googleapis.com/css?family=Titillium+Web|Oswald" rel="stylesheet">

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="js/d3.js"></script>
  <script src="js/c3.min.js"></script>
  <script src="js/leaflet.js"></script>
  <script src="js/jquery.min.js"></script>


</head>
<body>
  <!-- sidebar -->
  <div id="info">
  </div>
  <!-- mainwindow -->
  <div id="map"></div>

  <script>
  // 1.Create a map object and set the initial view point
  var mymap = L.map('map', {
    center: [37.413544, -125.312886],
    zoom: 6,
    maxZoom: 10,
    minZoom: 3,
    zoomControl: false,
    detectRetina: true
  });

  // 2. move the zoom control to the top right corner.
  new L.Control.Zoom({
    position: 'topright'
  }).addTo(mymap);


  // 3. Add a base map.
  L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}.png').addTo(mymap);

  // 4. Declare three global variables for the wa counties thematic layer, bar chart, and the organized wa data.
  var countiesLayer = null,
    bchart = null,
    counties = {};

  // 5. load all datasets through promise mechnism and store them in an array
  Promise.all([$.getJSON("data/cacountiesCount2.geojson")]).then(function(datasets) {

    // 6. Map relevant operations

    // 6.1 create a couties layer
    countiesLayer = L.geoJSON(datasets[0], {
       onEachFeature: onEachFeature
    }).addTo(mymap);

  });
  // 6.2 add three events to the the layer “countiesLayer”.
function onEachFeature(feature, layer) {
  layer.on({
    mouseover: highlightFeature,
    click: clickFeature,
    mouseout: resetHighlight
  });
}

// 6.3 this function works when the mouse hovers over on a map feature.
function highlightFeature(e) {
  // e indicates the current event
  var feature = e.target; //the target capture the object which the event associates with
  feature.setStyle({
    weight: 2,
    opacity: 0.8,
    color: '#e3e3e3',
    fillColor: '#00ffd9',
    fillOpacity: 0.1
  });
}

// 6.4 this function executes when the mouse clicks on a map feature.
function clickFeature(e) {
  L.DomEvent.stopPropagation(e);
  $("#placename").text(e.target.feature.properties.COUNTY_NAM + " County");
  $("#access-count").text(e.target.feature.properties.NUMPOINTS);
  $("#disaccess-count").text(e.target.feature.properties.DISACCESS);
  $("#percent").text((e.target.feature.properties.DISACCESS / e.target.feature.properties.NUMPOINTS * 100).toFixed(2) + " %");
}

// 6.5 reset the hightlighted feature when the mouse is out of its region.
function resetHighlight(e) {
  countiesLayer.resetStyle(e.target);
}

// 6.6 bind the onMapClick function to the mymap object.
mymap.on('click', onMapClick);
// when click on any place on the map expect the counties layer, the text on the sidebar will be reset to the total number of WA.
function onMapClick(e) {
  $("#placename").text("California Coast");
  $("#access-count").text("1637");
  $("#disaccess-count").text("794");
  $("#percent").text("48.50 %");
}
L.control.scale({position: 'bottomright'}).addTo(mymap);
    // the javascript script will be inserted here.
  </script>
  <!-- sidebar -->
<div id="info">

  <div id="title">
    California Beach Access
  </div>
  <p id="placename">California Coast</p>
  <div id="count" class="card">
    <h5 id="desc"> # Total Access Points</h5>
    <p id="access-count">1637</p>
    <h5 id="desc"> # Disability Access Points</h5>
    <p id="disaccess-count">794</p>
    <h5 id="desc"> % of Disability Access Points</h5>
    <p id="percent">48.50 %</p>
    <button id="mapButton" class="blue button" onclick="location.href='page2.html';">Access Point Map</button>
  </div>
  <div id="county-chart"></div>
  <div id="footer"></div>
</div>
</body>
</html>
